{
  "status": 0,
  "msg": "",
  "data": {
    "type": "page",
    "title": " ",
    "name": "product",
    "toolbar": [],
    "data": {
      "productType": [
        {
          "label": "全部类型",
          "value": 0
        },
        {
          "label": "体系课",
          "value": 1
        },
        {
          "label": "公开课",
          "value": 4
        },
        {
          "label": "线下大会",
          "value": 5
        },
        {
          "label": "社区课",
          "value": 6
        }
      ],
      "productForm": [
        {
          "label": "全部形式",
          "value": 0
        },
        {
          "label": "图文+音频",
          "value": 1
        },
        {
          "label": "视频",
          "value": 2
        }
      ],
      "productSort":  [
        {
          "label": "综合",
          "value": 8
        },
        {
          "label": "最新",
          "value": 1
        },
        {
          "label": "最热",
          "value": 4
        }
      ],
      "geektimeCategory": [],
      "geektimeDirection": []
    },
    "initApi": {
      "method": "get",
      "url": "/v2/sys/dict/tree?key=geektimeCategory",
      "responseData": {
        "&": "$$",
        "geektimeCategory": "${geektimeCategory}",
        "geektimeDirection": "${geektimeCategory|pick:key,label,value}"
      }
    },
    "body": [
      {
        "type": "crud",
        "name": "product-pvip",
        "parsePrimitiveQuery": {
          "enable": true,
          "types": [
            "boolean",
            "number"
          ]
        },
        "syncLocation": false,
        "headerToolbar": [
          "filter-toggler"
        ],
        "filter": {
          "title": "条件搜索",
          "body": [
            {
              "type": "list-select",
              "name": "direction",
              "label": "课程方向",
              "clearable": true,
              "value": 0,
              "source": "${geektimeDirection}",
              "onEvent": {
                "change": {
                  "actions": [
                    {
                      "actionType": "clear",
                      "componentId": "pvip_tag"
                    }
                  ]
                }
              }
            },
            {
              "type": "divider"
            },
            {
              "type": "each",
              "source": "${geektimeCategory}",
              "itemKeyName": "itemOutter",
              "indexKeyName": "indexOutter",
              "items": [
                {
                  "type": "list-select",
                  "id": "pvip_tag",
                  "name": "tag",
                  "label": "课程分类",
                  "clearable": true,
                  "value": "${itemOutter.value}",
                  "source": "${itemOutter.children}",
                  "visibleOn": "${direction == itemOutter.value}"
                }
              ]
            },
            {
              "type": "divider"
            },
            {
              "type": "group",
              "body": [
                {
                  "type": "list-select",
                  "clearable": true,
                  "label": "最新/热度",
                  "name": "sort",
                  "value": 8,
                  "source": "${productSort}"
                },
                {
                  "type": "select",
                  "label": "课程类型",
                  "name": "product_type",
                  "value": 0,
                  "source": "${productType}"
                },
                {
                  "type": "select",
                  "label": "课程形式",
                  "name": "product_form",
                  "value": 0,
                  "source": "${productForm}"
                },
                {
                  "type": "hidden",
                  "name": "with_articles",
                  "value": true
                },
                {
                  "type": "input-text",
                  "placeholder": "搜索关键字",
                  "clearable": true,
                  "name": "keyword"
                }
              ]
            }
          ],
          "actions": [
            {
              "type": "reset",
              "label": "重置"
            },
            {
              "type": "submit",
              "level": "primary",
              "label": "搜索"
            }
          ]
        },
        "api": {
          "method": "get",
          "url": "/v2/product/pvip/list",
          "data": {
            "perPage": 12,
            "page": "$page",
            "sort": "$sort",
            "direction": "$direction",
            "product_type": "$product_type",
            "product_form": "$product_form",
            "tag": "${ product_type===5 ? 0 : tag }",
            "with_articles": true,
            "keyword": "$keyword"
          }
        },
        "autoFillHeight": false,
        "keepItemSelectionOnPageChange": true,
        "bulkActions": [],
        "footerToolbar": [
          "statistics",
          "pagination"
        ],
        "mode": "cards",
        "columnsCount": 3,
        "card": {
          "header": {
            "className": "word-break",
            "title": "${title | raw}",
            "subTitle": "",
            "description": "${subtitle | raw}",
            "avatar": "${cover.square | raw}",
            "avatarClassName": "pull-left thumb-md avatar b-3x m-r"
          },
          "body": [
            {
              "type": "property",
              "title": "",
              "mode": "simple",
              "separator": "：",
              "items": [
                {
                  "label": "作者",
                  "content": "${author.name}",
                  "span": 3
                },
                {
                  "label": "作者简介",
                  "content": "${author.intro}",
                  "span": 3
                },
                {
                  "label": "ID",
                  "content": "${id}",
                  "span": 3
                },
                {
                  "label": "课程数",
                  "content": "${article.count} 讲",
                  "span": 2
                },
                {
                  "label": "类型",
                  "content": "${ is_audio === true ? '音频': '视频'}",
                  "visibleOn": "${ is_audio !== undefined }"
                },
                {
                  "label": "类型",
                  "content": "${ is_video === true ? '视频': '音频'}",
                  "visibleOn": "${ is_video !== undefined }"
                },
                {
                  "label": "完结",
                  "content": "${ is_finish === true ? '是': '否'}",
                  "span": 2
                },
                {
                  "label": "价格",
                  "content": "免费",
                  "visibleOn": "${ sale_type === 6 ||  sale_type === 7 }"
                },
                {
                  "label": "价格",
                  "content": "¥${ROUND(sale/100,2)}",
                  "visibleOn": "${ sale_type !== 6 &&  sale_type !== 7 }"
                }
              ]
            }
          ],
          "actions": [
              {
                "type": "action",
                "actionType": "url",
                "url": "${redirect}",
                "level": "light",
                "label": "源站",
                "visibleOn": "${ redirect !== undefined }"
              },
              {
                "type": "button",
                "icon": "fa fa-eye",
                "label": "详情",
                "level": "light",
                "actionType": "drawer",
                "drawer": {
                  "resizable": true,
                  "closeOnOutside": true,
                  "size": "xl",
                  "title": "课程详情",
                  "actions": [],
                  "body": [
                    {
                      "type": "card",
                      "header": {
                        "className": "word-break",
                        "title": "${title | raw}",
                        "subTitle": "${subtitle | raw}",
                        "description": "共 ${article.count} 讲",
                        "avatar": "${cover.square | raw}",
                        "avatarClassName": "pull-left thumb-md avatar b-3x m-r"
                      },
                      "body": []
                    },
                    {
                      "type": "divider"
                    },
                    {
                      "type": "html",
                      "wrapperComponent": "pre",
                      "className": "word-break",
                      "name": "intro_html",
                      "label": "课程介绍"
                    },
                    {
                      "type": "divider"
                    },
                    {
                      "type": "crud",
                      "name": "articles-list",
                      "parsePrimitiveQuery": {
                        "enable": true,
                        "types": [
                          "boolean",
                          "number"
                        ]
                      },
                      "syncLocation": false,
                      "api": {
                        "method": "get",
                        "url": "/v2/product/articles",
                        "data": {
                          "sample": false,
                          "order": "earliest",
                          "cid": "${id}",
                          "perPage": 500,
                          "page":  "${page}"
                        }
                      },
                      "mode": "cards",
                      "columnsCount": 3,
                      "checkOnItemClick": true,
                      "card": {
                        "header": {
                          "avatarText": "${article_title|substring:0:2|upperCase}",
                          "avatarTextBackground": [
                            "#FFB900",
                            "#D83B01",
                            "#B50E0E",
                            "#E81123",
                            "#B4009E",
                            "#5C2D91",
                            "#0078D7",
                            "#00B4FF",
                            "#008272"
                          ]
                        },
                        "body": [
                          {
                            "type": "hidden",
                            "name": "cid",
                            "value": "${id}"
                          },
                          {
                            "type": "text",
                            "name": "$article_title"
                          },
                          {
                            "type": "divider"
                          },
                          {
                            "type": "tpl",
                            "label": "",
                            "className": "word-break",
                            "tpl": "$article_summary"
                          },
                          {
                            "type": "divider"
                          },
                          {
                            "type": "property",
                            "title": "",
                            "mode": "simple",
                            "separator": "：",
                            "items": [
                              {
                                "label": "ID",
                                "content": "${id}"
                              },
                              {
                                "label": "视频大小",
                                "content": "${ FLOOR(video_size/1048576, 2) } M",
                                "visibleOn": "${ video_size !== undefined }"
                              },
                              {
                                "label": "音频大小",
                                "content": "${ FLOOR(audio_size/1048576, 2) } M",
                                "visibleOn": "${ audio_size !== undefined }"
                              }
                            ]
                          }
                        ],
                        "actions": [
                          {
                            "type": "button",
                            "icon": "fa fa-eye",
                            "label": "详情",
                            "level": "light",
                            "actionType": "drawer",
                            "drawer": {
                              "resizable": true,
                              "closeOnOutside": true,
                              "actions": [],
                              "width": "70%",
                              "title": [
                                {
                                  "type": "service",
                                  "api": {
                                    "method": "get",
                                    "url": "/v2/product/article/info?id=${id}"
                                  },
                                  "body": [
                                    {
                                      "type": "property",
                                      "title": "${title}",
                                      "mode": "simple",
                                      "separator": "：",
                                      "items": [
                                        {
                                          "label": "ID",
                                          "content": "${id}"
                                        },
                                        {
                                          "label": "视频大小",
                                          "content": "${ FLOOR(video_size/1048576, 2) } M",
                                          "visibleOn": "${ video_size !== undefined }"
                                        },
                                        {
                                          "label": "音频大小",
                                          "content": "${ FLOOR(audio_size/1048576, 2) } M",
                                          "visibleOn": "${ audio_size !== undefined }"
                                        }
                                      ]
                                    },
                                    {
                                      "type": "video",
                                      "style": {
                                        "width": "30%",
                                        "height": "30%",
                                        "margin": 5
                                      },
                                      "muted": true,
                                      "autoPlay": false,
                                      "rates": [1.0, 1.2, 1.5, 2.0],
                                      "src": "${video.hls_medias|last|pick:url}",
                                      "poster": "${cover.default}",
                                      "visibleOn": "${ video.hls_medias !== undefined }"
                                    },
                                    {
                                      "type": "video",
                                      "style": {
                                        "width": "30%",
                                        "height": "30%",
                                        "margin": 5
                                      },
                                      "muted": true,
                                      "autoPlay": false,
                                      "rates": [1.0, 1.2, 1.5, 2.0],
                                      "src": "${video_preview.medias|last|pick:url}",
                                      "poster": "${cover.default}",
                                      "visibleOn": "${ video.hls_medias === undefined && video_preview.medias !== undefined }"
                                    },
                                    {
                                      "type": "video",
                                      "style": {
                                        "width": "30%",
                                        "height": "30%",
                                        "margin": 5
                                      },
                                      "muted": true,
                                      "autoPlay": false,
                                      "rates": [1.0, 1.2, 1.5, 2.0],
                                      "src": "${audio.url}",
                                      "poster": "${cover.default}",
                                      "visibleOn": "${ audio.url !== undefined }"
                                    }
                                  ]
                                }
                              ],
                              "body": [
                                {
                                  "type": "service",
                                  "api": {
                                    "method": "get",
                                    "url": "/v2/product/article/info?id=${id}"
                                  },
                                  "body": [
                                    {
                                      "type": "action",
                                      "size": "sm",
                                      "level": "info",
                                      "actionType": "url",
                                      "url": "${redirect}",
                                      "label": "查看源站",
                                      "visibleOn": "${ redirect !== undefined }"
                                    },
                                    {
                                      "type": "html",
                                      "className": "word-break",
                                      "name": "content",
                                      "label": "内容"
                                    }
                                  ]
                                },
                                {
                                  "type": "crud",
                                  "label": "评论列表",
                                  "api": {
                                    "method": "get",
                                    "url": "/v2/product/article/commonts",
                                    "data": {
                                      "perPage": "${perPage}",
                                      "aid": "${id}",
                                      "page": "$page"
                                    }
                                  },
                                  "defaultParams": {
                                    "perPage": 10
                                  },
                                  "columns": [
                                    {
                                      "name": "id",
                                      "label": "ID",
                                      "type": "hidden"
                                    },
                                    {
                                      "name": "user_header",
                                      "label": "头像",
                                      "text": "${user_name}",
                                      "type": "avatar",
                                      "src": "${user_header}",
                                      "onError": "return true;"
                                    },
                                    {
                                      "name": "user_name",
                                      "label": "用户名",
                                      "type": "text",
                                      "width": 150
                                    },
                                    {
                                      "name": "discussion_count",
                                      "label": "讨论数",
                                      "type": "text",
                                      "width": 50
                                    },
                                    {
                                      "name": "like_count",
                                      "label": "点赞数",
                                      "type": "text",
                                      "width": 50
                                    },
                                    {
                                      "name": "comment_content",
                                      "label": "评论内容",
                                      "className": "word-break",
                                      "type": "html"
                                    },
                                    {
                                      "type": "operation",
                                      "label": "操作",
                                      "width": 100,
                                      "buttons": [
                                        {
                                          "type": "button",
                                          "label": "查看讨论",
                                          "actionType": "dialog",
                                          "level": "info",
                                          "visibleOn": "${ discussion_count > 0 }",
                                          "dialog": {
                                            "title": "查看讨论",
                                            "size": "lg",
                                            "body": [
                                              {
                                                "type": "crud",
                                                "label": "讨论列表",
                                                "api": {
                                                  "method": "get",
                                                  "url": "/v2/product/article/discussions",
                                                  "data": {
                                                    "perPage": "${perPage}",
                                                    "page": "$page",
                                                    "use_likes_order": true,
                                                    "target_id": "${id}",
                                                    "target_type": 1,
                                                    "size": "${perPage}",
                                                    "prev": "$page",
                                                    "page_type": 1
                                                  }
                                                },
                                                "defaultParams": {
                                                  "perPage": 10
                                                },
                                                "columns": [
                                                  {
                                                    "name": "discussion.id",
                                                    "label": "ID",
                                                    "type": "text",
                                                    "toggled": true,
                                                    "width": 60
                                                  },
                                                  {
                                                    "name": "author.avatar",
                                                    "label": "头像",
                                                    "text": "${author.nickname}",
                                                    "type": "avatar",
                                                    "src": "${author.avatar}",
                                                    "onError": "return true;"
                                                  },
                                                  {
                                                    "name": "author.nickname",
                                                    "label": "昵称",
                                                    "type": "text",
                                                    "width": 100
                                                  },
                                                  {
                                                    "name": "discussion.ctime",
                                                    "label": "时间",
                                                    "type": "date",
                                                    "format": "YYYY-MM-DD",
                                                    "width": 100
                                                  },
                                                  {
                                                    "name": "discussion.likes_number",
                                                    "label": "点赞数",
                                                    "type": "text",
                                                    "width": 50
                                                  },
                                                  {
                                                    "name": "discussion.discussion_content",
                                                    "label": "讨论内容",
                                                    "className": "word-break",
                                                    "type": "html"
                                                  }
                                                ]
                                              }
                                            ]
                                          }
                                        }
                                      ],
                                      "toggled": true,
                                      "placeholder": "-"
                                    }
                                  ]
                                }
                              ]
                            }
                          },
                          {
                            "type": "button",
                            "icon": "fa fa-eye",
                            "label": "缓存",
                            "level": "light",
                            "actionType": "drawer",
                            "visibleOn": "${ ls:geek_auth === undefined }",
                            "drawer": {
                              "resizable": true,
                              "closeOnOutside": true,
                              "actions": [],
                              "size": "md",
                              "title": "cookie登录",
                              "body": [
                                "请先保存【极客时间VIP登录凭据】，该登录凭据是全站共享的基础,下载期间避免失效，失效后下载会找不到下载链接  ",
                                "<a href='https://zkep.github.io/my-geektime/guide/data_geektime/' target='_blank'>查看详细文档</a>",
                                {
                                  "type": "form",
                                  "title": "",
                                  "actions": [],
                                  "wrapWithPanel": false,
                                  "api": {
                                    "url": "/v2/base/refresh/cookie?waitSeconds=3",
                                    "method": "post",
                                    "data": {
                                      "cookie": "${cookie}"
                                    },
                                    "adaptor": "if (payload.status === 0){\nlocalStorage.setItem(\"geek_auth\", true);\nsetTimeout(\"location.href='/';\", 3000);\n}\nreturn payload;"
                                  },
                                  "body": [
                                    {
                                      "label": "Cookie",
                                      "type": "textarea",
                                      "showCounter": true,
                                      "clearable": true,
                                      "required": true,
                                      "placeholder": "请输入极客时间Cookie",
                                      "name": "cookie",
                                      "validations": {
                                        "minLength": 50
                                      },
                                      "validationErrors": {
                                        "minLength": "Cookie不少于$1个字符"
                                      },
                                      "borderMode": "half",
                                      "style": {
                                        "margin": 20
                                      }
                                    },
                                    {
                                      "type": "flex",
                                      "alignItems": "center",
                                      "style": {
                                        "height": "100%",
                                        "backgroundColor": "#fff"
                                      },
                                      "items": [
                                        {
                                          "label": "刷 新｜Refresh",
                                          "level": "light",
                                          "size": "lg",
                                          "type": "submit",
                                          "style": {
                                            "margin": 20
                                          }
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ]
                            }
                          },
                          {
                            "type": "button",
                            "label": "缓存",
                            "level": "info",
                            "icon": "fa fa-download",
                            "visibleOn": "${ ls:geek_auth !== undefined  }",
                            "actionType": "ajax",
                            "api": {
                              "url": "/v2/product/download",
                              "method":"post",
                              "data": {
                                "pid": "${cid | toInt}",
                                "ids": "${id | trim}"
                              },
                              "adaptor": "if(payload.status === 10002){\nlocalStorage.removeItem(\"geek_auth\");\nsetTimeout(\"location.href='/';\", 3000);\n}\nreturn payload;"
                            },
                            "confirmText": "缓存 [${ title }]，\n 请在[我的课程]查看详情"
                          }
                        ]
                      },
                      "keepItemSelectionOnPageChange": false,
                      "bulkActions": [
                        {
                          "type": "button",
                          "icon": "fa fa-eye",
                          "label": "批量缓存",
                          "level": "light",
                          "actionType": "drawer",
                          "visibleOn": "${ ls:geek_auth === undefined }",
                          "drawer": {
                            "resizable": true,
                            "closeOnOutside": true,
                            "actions": [],
                            "size": "md",
                            "title": "cookie登录",
                            "body": [
                              "请先保存【极客时间VIP登录凭据】，该登录凭据是全站共享的基础,下载期间避免失效，失效后下载会找不到下载链接  ",
                              "<a href='https://zkep.github.io/my-geektime/guide/data_geektime/' target='_blank'>查看详细文档</a>",
                              {
                                "type": "form",
                                "title": "",
                                "actions": [],
                                "wrapWithPanel": false,
                                "api": {
                                  "url": "/v2/base/refresh/cookie?waitSeconds=3",
                                  "method": "post",
                                  "data": {
                                    "cookie": "${cookie}"
                                  },
                                  "adaptor": "if (payload.status === 0){\nlocalStorage.setItem(\"geek_auth\", true);setTimeout(\"location.href='/';\", 3000);\n}\nreturn payload;"
                                },
                                "body": [
                                  {
                                    "label": "Cookie",
                                    "type": "textarea",
                                    "showCounter": true,
                                    "clearable": true,
                                    "required": true,
                                    "placeholder": "请输入极客时间Cookie",
                                    "name": "cookie",
                                    "validations": {
                                      "minLength": 50
                                    },
                                    "validationErrors": {
                                      "minLength": "Cookie不少于$1个字符"
                                    },
                                    "borderMode": "half",
                                    "style": {
                                      "margin": 20
                                    }
                                  },
                                  {
                                    "type": "flex",
                                    "alignItems": "center",
                                    "style": {
                                      "height": "100%",
                                      "backgroundColor": "#fff"
                                    },
                                    "items": [
                                      {
                                        "label": "刷 新｜Refresh",
                                        "level": "light",
                                        "size": "lg",
                                        "type": "submit",
                                        "style": {
                                          "margin": 20
                                        }
                                      }
                                    ]
                                  }
                                ]
                              }
                            ]
                          }
                        },
                        {
                          "label": "批量缓存",
                          "level": "info",
                          "actionType": "ajax",
                          "visibleOn": "${ ls:geek_auth !== undefined }",
                          "api": {
                            "url": "/v2/product/download",
                            "method":"post",
                            "data": {
                              "pid": "${cid | toInt}",
                              "ids": "${ids|raw}"
                            },
                            "adaptor": "if(payload.status === 10002){\nlocalStorage.removeItem(\"geek_auth\");\nsetTimeout(\"location.href='/';\", 3000);\n}\nreturn payload;"
                          },
                          "confirmText": "缓存 [${ title }]，\n 请在[我的课程]查看详情"
                        }
                      ],
                      "headerToolbar": [
                        "filter-toggler",
                        "bulkActions",
                        {
                          "type": "tpl",
                          "tpl": "当前有 ${count} 条数据。",
                          "className": "v-middle"
                        }
                      ],
                      "footerToolbar": [],
                      "affixHeader": true,
                      "columnsTogglable": "auto",
                      "placeholder": "暂无数据",
                      "tableClassName": "table-db table-striped",
                      "headerClassName": "crud-table-header",
                      "footerClassName": "crud-table-footer",
                      "toolbarClassName": "crud-table-toolbar",
                      "combineNum": 0,
                      "bodyClassName": "panel-default"
                    }
                  ]
                }
              },
              {
                "type": "button",
                "icon": "fa fa-eye",
                "label": "缓存",
                "level": "light",
                "actionType": "drawer",
                "visibleOn": "${ ls:geek_auth === undefined }",
                "drawer": {
                  "resizable": true,
                  "closeOnOutside": true,
                  "actions": [],
                  "size": "md",
                  "title": "cookie登录",
                  "body": [
                    "请先保存【极客时间VIP登录凭据】，该登录凭据是全站共享的基础,下载期间避免失效，失效后下载会找不到下载链接  ",
                    "<a href='https://zkep.github.io/my-geektime/guide/data_geektime/' target='_blank'>查看详细文档</a>",
                    {
                      "type": "form",
                      "title": "",
                      "actions": [],
                      "wrapWithPanel": false,
                      "api": {
                        "url": "/v2/base/refresh/cookie?waitSeconds=3",
                        "method": "post",
                        "data": {
                          "cookie": "${cookie}"
                        },
                        "adaptor": "if (payload.status === 0){\nlocalStorage.setItem(\"geek_auth\", true);\nsetTimeout(\"location.href='/';\", 3000);\n}\nreturn payload;"
                      },
                      "body": [
                        {
                          "label": "Cookie",
                          "type": "textarea",
                          "showCounter": true,
                          "clearable": true,
                          "required": true,
                          "placeholder": "请输入极客时间Cookie",
                          "name": "cookie",
                          "validations": {
                            "minLength": 50
                          },
                          "validationErrors": {
                            "minLength": "Cookie不少于$1个字符"
                          },
                          "borderMode": "half",
                          "style": {
                            "margin": 20
                          }
                        },
                        {
                          "type": "flex",
                          "alignItems": "center",
                          "style": {
                            "height": "100%",
                            "backgroundColor": "#fff"
                          },
                          "items": [
                            {
                              "label": "刷 新｜Refresh",
                              "level": "light",
                              "size": "lg",
                              "type": "submit",
                              "style": {
                                "margin": 20
                              }
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              },
              {
                "type": "button",
                "label": "缓存",
                "level": "info",
                "icon": "fa fa-download",
                "actionType": "ajax",
                "visibleOn": "${ ls:geek_auth !== undefined }",
                "confirmText": "缓存 [${ title }],\n 请在 [我的课程] 查看详情",
                "api": {
                  "url": "/v2/product/download",
                  "method":"post",
                  "data": {
                    "pid": "${id | toInt}"
                  },
                  "adaptor": "if(payload.status === 10002){\nlocalStorage.removeItem(\"geek_auth\");\nsetTimeout(\"location.href='/';\", 3000);\n}\nreturn payload;"
                }
              }
            ]
        },
        "affixHeader": true,
        "columnsTogglable": "auto",
        "placeholder": "暂无数据",
        "tableClassName": "table-db table-striped",
        "headerClassName": "crud-table-header",
        "footerClassName": "crud-table-footer",
        "toolbarClassName": "crud-table-toolbar",
        "combineNum": 0,
        "bodyClassName": "panel-default"
      }
    ]
  }
}
